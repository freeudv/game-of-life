<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

  <script>
    function createCell(row, col, alive = false) {
      // вернуть объект сетки
      return { row, col, alive };
    }

    function createGrid(size, randomize = false) {
      // создать массив определенного размера (new Array(size))
      // внутри массива создать еще массивы
      // в каждый элемент массива поместить клетку
      // либо в разнобой (50% что клетка жива, 50% что клетка мертва)
      // либо начальное состояние (клетка мертва)
      // вернуть сетку
      let grid = [
        [{ row: 0, col: 0, alive: false }, { row: 0, col: 1, alive: true }, { row: 0, col: 2, alive: false }],
        [{ row: 1, col: 0, alive: false }, { row: 1, col: 1, alive: true }, { row: 1, col: 2, alive: false }],
        [{ row: 2, col: 0, alive: false }, { row: 2, col: 1, alive: true }, { row: 2, col: 2, alive: false }]
      ];

      /*       for (let i = 0; i < size; i++) {
              let row = [];

              for (let j = 0; j < size; j++) {
                let alive = !randomize ? false : Math.floor(Math.random() * 2) ? true : false;

                row.push(createCell(i, j, alive));
              }

              grid.push(row);
            } */

      return grid;
    }

    function countNeighbors(grid, cell) {
      let { row, col } = cell;
      let length = grid.length - 1;
      let neighbors = 0;

      if ((row - 1 > 0) && (grid[row - 1][col].alive)) neighbors += 1;
      if ((row - 1 > 0) && (col - 1 > 0) && (grid[row - 1][col - 1].alive)) neighbors += 1;
      if ((row - 1 > 0) && (col + 1 < length) && (grid[row - 1][col + 1].alive)) neighbors += 1;

      if ((col - 1 > 0) && (grid[row][col - 1].alive)) neighbors += 1;
      if ((col + 1 < length) && (grid[row][col + 1].alive)) neighbors += 1;

      if ((row + 1 < length) && (grid[row + 1][col].alive)) neighbors += 1;
      if ((row + 1 < length) && (col - 1 > 0) && (grid[row + 1][col - 1].alive)) neighbors += 1;
      if ((row + 1 < length) && (col + 1 < length) && (grid[row + 1][col + 1].alive)) neighbors += 1;

      return neighbors;
    }

    function computeGrid(grid) {
      // создать новую сетку
      // взяв одну клетку текущей сетки
      // посчитать количество соседей
      // изменить состояние клетки в новой сетке согласно правилам игры
      // вернуть новую сетку
      let newGrid = grid.slice();
      console.log(grid === newGrid);
      console.log(newGrid);
      console.log(grid);
      console.log(newGrid);
      for (let i = 0; i < grid.length; i++) {
        let row = grid[i];

        for (let j = 0; j < row.length; j++) {

          let cell = grid[i][j];
          let neighbords = countNeighbors(grid, cell);

          if (neighbords < 2 || neighbords > 3) {
            newGrid[i][j] = createCell(i, j, false);

          } else if (neighbords === 3) {
            newGrid[i][j] = createCell(i, j, true);

          } else {
            newGrid[i][j] = grid[i][j];
          };
          // console.log(neighbords);
          // console.log(grid[i][j]);
          // console.log(newGrid[i][j]);
        }
      }

      return newGrid;
    }

    function renderGrid(grid) {
      // начнем с пустой строки
      // взяв одну клетку
      // если клетка жива добавить '* ' (звездочка пробел) в строку
      // иначе добавить '  ' (два пробела)
      // если клетка последняя в ряду, перейти на следующую строку (\r\n)
      // вернуть готовую строку
      let str = [];
      let length = grid.length;

      for (let i = 0; i < length; i++) {

        for (let j = 0; j < length; j++) {
          let renderAlave = grid[i][j].alive ? '* ' : "  ";
          str.push(renderAlave);
          if (j === length - 1) str.push('\r\n');
        }
      }
      console.log(str.join(''));
      return str.join('');
    }


    const grid = createGrid();
    console.log(grid);
    renderGrid(grid);

    const newGrid = computeGrid(grid);
    //    console.log(newGrid);

    renderGrid(grid);
//    renderGrid(newGrid);
  </script>
</body>

</html>
